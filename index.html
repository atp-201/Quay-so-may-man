<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>S·ªë May M·∫Øn / Quay T√™n</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#b9f5d6;
}
.container{
    max-width:420px;
    margin:20px auto;
    background:#fff;
    border-radius:16px;
    padding:20px;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.tab{
    background:#6ee64d;
    border-radius:30px;
    margin-bottom:15px;
    text-align:center;
    color:#fff;
    font-weight:bold;
    padding:10px;
}
.option{
    display:flex;
    gap:15px;
    margin-bottom:15px;
    flex-wrap:wrap;
}
.option label{
    display:flex;
    align-items:center;
    gap:6px;
}
.group{margin-bottom:15px;}
.group input,.group select,.group textarea{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:16px;
}
.button button{
    width:100%;
    padding:14px;
    font-size:18px;
    border:none;
    border-radius:30px;
    background:#111;
    color:#fff;
    cursor:pointer;
}
.result{
    margin-top:15px;
    background:#f8f8f8;
    border-radius:12px;
    padding:15px;
    text-align:center;
}
.result span{
    font-size:52px;
    color:red;
    font-weight:bold;
    word-break:break-word;
}
#history{
    margin-top:10px;
    font-size:14px;
    text-align:left;
    max-height:140px;
    overflow:auto;
}
.hidden{display:none}

.firework{
    position:fixed;
    width:6px;
    height:6px;
    border-radius:50%;
    animation:explode 1s ease-out forwards;
}
@keyframes explode{
    to{
        transform:translate(var(--x),var(--y));
        opacity:0;
    }
}
</style>
</head>

<body>

<div class="container">
    <div class="tab">S·ªê MAY M·∫ÆN / QUAY T√äN</div>

    <!-- CH·ªåN LO·∫†I -->
    <div class="option">
        <label><input type="radio" name="type" checked onclick="setType('number')"> üî¢ Quay s·ªë</label>
        <label><input type="radio" name="type" onclick="setType('name')"> üë§ Quay t√™n</label>
    </div>

    <!-- MODE NUMBER -->
    <div id="numberMode">
        <div class="option">
            <label><input type="radio" name="mode" checked onclick="setMode('range')"> Kho·∫£ng</label>
            <label><input type="radio" name="mode" onclick="setMode('list')"> Danh s√°ch</label>
        </div>

        <div id="rangeMode">
            <div class="group">
                <label>T·ª´ s·ªë:</label>
                <input type="number" id="min" value="1">
            </div>
            <div class="group">
                <label>ƒê·∫øn s·ªë:</label>
                <input type="number" id="max" value="50">
            </div>
        </div>

        <div id="listMode" class="hidden">
            <div class="group">
                <label>Danh s√°ch s·ªë:</label>
                <input type="text" id="list" placeholder="01,25,130,888">
            </div>
        </div>
    </div>

    <!-- MODE NAME -->
    <div id="nameMode" class="hidden">
        <div class="group">
            <label>Danh s√°ch t√™n (c√°ch nhau b·∫±ng d·∫•u ph·∫©y):</label>
            <textarea id="nameList" rows="4"
                placeholder="Nguy·ªÖn VƒÉn A, Tr·∫ßn Th·ªã B, L√™ VƒÉn C"></textarea>
        </div>
    </div>

    <div class="group">
        <label>Th·ªùi gian quay:</label>
        <select id="time">
            <option value="3000">3 gi√¢y</option>
            <option value="5000" selected>5 gi√¢y</option>
            <option value="10000">10 gi√¢y</option>
        </select>
    </div>

    <div class="button">
        <button onclick="spin()">QUAY</button>
    </div>

    <div class="button">
        <button onclick="resetHistory()" style="background:#e53935">Reset l·ªãch s·ª≠</button>
    </div>

    <div class="result">
        <span id="output">--</span>
        <div id="history"></div>
    </div>

    <!-- üîê RIG -->
    <div id="rigPanel" class="hidden" style="margin-top:10px;border-top:1px dashed #ccc;padding-top:10px">
        <label><input type="checkbox" id="rigMode"> Ch·∫ø ƒë·ªô rig</label>
        <input id="rigValue" placeholder="S·ªë ho·∫∑c T√™n ƒë·∫∑t tr∆∞·ªõc"
               style="width:100%;margin-top:6px">
    </div>
</div>

<audio id="bgMusic" src="spin.mp3" loop></audio>

<script>
let type="number";
let mode="range";
let history=JSON.parse(localStorage.getItem("history"))||[];
const output=document.getElementById("output");
const historyDiv=document.getElementById("history");

function setType(t){
    type=t;
    numberMode.classList.toggle("hidden",t!=="number");
    nameMode.classList.toggle("hidden",t!=="name");
}

function setMode(m){
    mode=m;
    rangeMode.classList.toggle("hidden",m!=="range");
    listMode.classList.toggle("hidden",m!=="list");
}

function renderHistory(){
    historyDiv.innerHTML=history.map(h=>h).join("<br>");
}
renderHistory();

window.addEventListener("click",()=>bgMusic.play(),{once:true});

function getPool(){
    if(type==="number"){
        if(mode==="range"){
            let arr=[];
            for(let i=+min.value;i<=+max.value;i++){
                if(!history.includes(`üéâ ${i}`)) arr.push(i);
            }
            return arr;
        }else{
            return list.value.split(",")
                .map(x=>x.trim())
                .filter(x=>x && !history.includes(`üéâ ${x}`));
        }
    }else{
        return nameList.value.split(",")
            .map(x=>x.trim())
            .filter(x=>x && !history.includes(`üë§ ${x}`));
    }
}

function firework(){
    for(let i=0;i<30;i++){
        let f=document.createElement("div");
        f.className="firework";
        f.style.left="50%";
        f.style.top="50%";
        f.style.background=`hsl(${Math.random()*360},100%,50%)`;
        f.style.setProperty("--x",`${Math.random()*400-200}px`);
        f.style.setProperty("--y",`${Math.random()*400-200}px`);
        document.body.appendChild(f);
        setTimeout(()=>f.remove(),1000);
    }
}

function spin(){
    let pool=getPool();
    if(pool.length===0){
        alert("ƒê√£ h·∫øt!");
        return;
    }

    let total=+time.value;
    let start=performance.now();
    let delay=30,maxDelay=220;

    function roll(){
        let p=(performance.now()-start)/total;
        if(p>1) p=1;
        delay=30+(maxDelay-30)*p*p;
        output.innerText=pool[Math.floor(Math.random()*pool.length)];
        if(p<1) setTimeout(roll,delay);
        else finalize(pool);
    }
    roll();
}

function finalize(pool){
    let final;
    let rig = rigValue.value.trim();

    if(rigMode.checked && rig){
        if(type === "number"){
            if(mode === "range"){
                rig = Number(rig);
                if(pool.includes(rig)) final = rig;
            }else{
                // danh s√°ch s·ªë ‚Üí so s√°nh STRING
                if(pool.includes(rig)) final = rig;
            }
        }else{
            // quay t√™n ‚Üí string
            if(pool.includes(rig)) final = rig;
        }
    }

    if(final === undefined){
        final = pool[Math.floor(Math.random() * pool.length)];
    }

    let record = type==="number" ? `üéâ ${final}` : `üë§ ${final}`;
    output.innerText = final;
    history.push(record);
    localStorage.setItem("history", JSON.stringify(history));
    renderHistory();
    firework();
}


function resetHistory(){
    if(confirm("X√≥a to√†n b·ªô l·ªãch s·ª≠?")){
        history=[];
        localStorage.removeItem("history");
        renderHistory();
        output.innerText="--";
    }
}

/* üîê Ctrl + Alt + R */
document.addEventListener("keydown",e=>{
    if(e.ctrlKey && e.altKey && e.key.toLowerCase()==="r"){
        rigPanel.classList.toggle("hidden");
    }
});
</script>

</body>
</html>
