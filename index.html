<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>S·ªë May M·∫Øn</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#b9f5d6;
}
.container{
    max-width:380px;
    margin:20px auto;
    background:#fff;
    border-radius:16px;
    padding:20px;
    box-shadow:0 10px 30px rgba(0,0,0,.1);
}
.tab{
    background:#6ee64d;
    border-radius:30px;
    margin-bottom:20px;
    text-align:center;
    color:#fff;
    font-weight:bold;
    padding:10px;
}
.option{
    display:flex;
    gap:20px;
    margin-bottom:15px;
}
.group{margin-bottom:15px;}
.group input,.group select{
    width:100%;
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
    font-size:16px;
}
.button button{
    width:100%;
    padding:14px;
    font-size:18px;
    border:none;
    border-radius:30px;
    background:#111;
    color:#fff;
    cursor:pointer;
}
.result{
    margin-top:15px;
    background:#f8f8f8;
    border-radius:12px;
    padding:15px;
    text-align:center;
}
.result span{
    font-size:52px;
    color:red;
    font-weight:bold;
}
#history{
    margin-top:10px;
    font-size:14px;
    text-align:left;
    max-height:120px;
    overflow:auto;
}
.hidden{display:none}

.firework{
    position:fixed;
    width:6px;
    height:6px;
    border-radius:50%;
    animation:explode 1s ease-out forwards;
}
@keyframes explode{
    to{
        transform:translate(var(--x),var(--y));
        opacity:0;
    }
}
</style>
</head>

<body>

<div class="container">
    <div class="tab">S·ªê MAY M·∫ÆN</div>

    <div class="option">
        <label><input type="radio" name="mode" checked onclick="setMode('range')"> Ch·ªçn s·ªë</label>
        <label><input type="radio" name="mode" onclick="setMode('list')"> Nh·∫≠p s·ªë</label>
    </div>

    <div id="rangeMode">
        <div class="group">
            <label>T·ª´ s·ªë:</label>
            <input type="number" id="min" value="1">
        </div>
        <div class="group">
            <label>ƒê·∫øn s·ªë:</label>
            <input type="number" id="max" value="50">
        </div>
    </div>

    <div id="listMode" class="hidden">
        <div class="group">
            <label>Nh·∫≠p s·ªë:</label>
            <input type="text" id="list" placeholder="01,25,130,888">
        </div>
    </div>

    <div class="group">
        <label>Th·ªùi gian quay:</label>
        <select id="time">
            <option value="3000">3 gi√¢y</option>
            <option value="5000" selected>5 gi√¢y</option>
            <option value="10000">10 gi√¢y</option>
        </select>
    </div>

    <div class="button">
        <button onclick="spin()">QUAY S·ªê</button>
    </div>

    <div class="button">
        <button onclick="resetHistory()" style="background:#e53935">Reset l·ªãch s·ª≠</button>
    </div>

    <div class="result">
        <span id="output">00</span>
        <div id="history"></div>
    </div>

    <!-- üîê RIG -->
    <div id="rigPanel" class="hidden" style="margin-top:10px;border-top:1px dashed #ccc;padding-top:10px">
        <label><input type="checkbox" id="rigMode"> Ch·∫ø ƒë·ªô rig</label>
        <input id="rigNumber" type="number" placeholder="S·ªë ƒë·∫∑t tr∆∞·ªõc" style="width:100%;margin-top:6px">
    </div>
</div>

<audio id="bgMusic" src="spin.mp3" loop></audio>

<script>
let mode="range";
let history=JSON.parse(localStorage.getItem("history"))||[];
const output=document.getElementById("output");
const historyDiv=document.getElementById("history");

function setMode(m){
    mode=m;
    rangeMode.classList.toggle("hidden",m!=="range");
    listMode.classList.toggle("hidden",m!=="list");
}

function renderHistory(){
    historyDiv.innerHTML=history.map(n=>`üéâ ${n}`).join("<br>");
}
renderHistory();

window.addEventListener("click",()=>bgMusic.play(),{once:true});

/* L·∫§Y DANH S√ÅCH S·ªê H·ª¢P L·ªÜ */
function getPool(){
    if(mode==="range"){
        let arr=[];
        for(let i=+min.value;i<=+max.value;i++){
            if(!history.includes(i)) arr.push(i);
        }
        return arr;
    }else{
        return list.value
            .split(",")
            .map(x=>parseInt(x.trim()))
            .filter(n=>!isNaN(n) && !history.includes(n));
    }
}

/* PH√ÅO HOA */
function firework(){
    for(let i=0;i<30;i++){
        let f=document.createElement("div");
        f.className="firework";
        f.style.left="50%";
        f.style.top="50%";
        f.style.background=`hsl(${Math.random()*360},100%,50%)`;
        f.style.setProperty("--x",`${Math.random()*400-200}px`);
        f.style.setProperty("--y",`${Math.random()*400-200}px`);
        document.body.appendChild(f);
        setTimeout(()=>f.remove(),1000);
    }
}

/* üî• QUAY TƒÇNG T·ªêC ‚Üí CH·∫¨M D·∫¶N */
function spin(){
    let pool=getPool();
    if(pool.length===0){
        alert("H·∫øt s·ªë!");
        return;
    }

    let totalTime=+time.value;
    let start=performance.now();
    let delay=30;          // l√∫c ƒë·∫ßu r·∫•t nhanh
    let maxDelay=220;      // c√†ng v·ªÅ cu·ªëi c√†ng ch·∫≠m

    function roll(){
        let now=performance.now();
        let progress=(now-start)/totalTime;
        if(progress>1) progress=1;

        // easing (tƒÉng t·ªëc ‚Üí ch·∫≠m d·∫ßn)
        delay = 30 + (maxDelay-30) * progress * progress;

        output.innerText = pool[Math.floor(Math.random()*pool.length)];

        if(progress < 1){
            setTimeout(roll, delay);
        }else{
            finalize(pool);
        }
    }
    roll();
}

function finalize(pool){
    let final;

    if(rigMode.checked && rigNumber.value){
        let r=parseInt(rigNumber.value);
        if(pool.includes(r)) final=r;
    }
    if(final===undefined){
        final=pool[Math.floor(Math.random()*pool.length)];
    }

    output.innerText=final;
    history.push(final);
    localStorage.setItem("history",JSON.stringify(history));
    renderHistory();
    firework();
}

function resetHistory(){
    if(confirm("X√≥a to√†n b·ªô l·ªãch s·ª≠?")){
        history=[];
        localStorage.removeItem("history");
        renderHistory();
        output.innerText="00";
    }
}

/* üîê Ctrl + Alt + R */
document.addEventListener("keydown",e=>{
    if(e.ctrlKey && e.altKey && e.key.toLowerCase()==="r"){
        rigPanel.classList.toggle("hidden");
    }
});
</script>

</body>
</html>
